## 指令执行流程

|       类        |                             函数                             |                        功能                        |
| :-------------: | :----------------------------------------------------------: | :------------------------------------------------: |
|        -        |                  main@src/observer/main.cpp                  | 启动服务端（解析命令行参数、加载配置文件、初始化） |
|     Server      |               recv@src/observer/net/server.cpp               |          接收客户端消息并创建SessionEvent          |
|  SessionStage   |    handle_request@src/observer/session/session_stage.cpp     |        处理SessionEvent并创建SQLStageEvent         |
|  SessionStage   |      handle_sql@src/observer/session/session_stage.cpp       |                执行各阶段的SQL处理                 |
| QueryCacheStage | handle_request@src/observer/sql/query_cache/query_cache_stage.cpp |                                                    |
|   ParserStage   |   handle_request@src/observer/sql/parser/parser_stage.cpp    |             解析SQL语句为ParsedSqlNode             |
|  ResolveStage   |   handle_request@src/observer/sql/parser/resolve_stage.cpp   |              解析ParsedSqlNode为Stmt               |
|  OptimizeStage  | handle_request@src/observer/sql/optimizer/optimize_stage.cpp |     执行查询优化（一般在select、delete时使用）     |
|  ExecuteStage   |  handle_request@src/observer/sql/executor/execute_stage.cpp  |              调用CommandExecutor执行               |
| CommandExecutor |    execute@src/observer/sql/executor/command_executor.cpp    |                根据StmtType分发执行                |
|    Executor     |                              -                               |           调用db->调用table执行相关操作            |

## 文件列表说明

|      路径       |           重要类            |                     说明                     |
| :-------------: | :-------------------------: | :------------------------------------------: |
|     common      |            Init             |               初始化服务器配置               |
|      event      |   SessionEvent、SqlEvent    |           处理SQL请求、SQL调试信息           |
|       net       |           Server            |       网络模块，负责客户端与服务端通信       |
|     session     |        SessionStage         |   创建Session窗口（每次输入SQL语句时创建）   |
|   sql/parser    |  ParseStage、ResolveStage   | SQL解析处理阶段，将SQL解析为语法树和Stmt语义 |
|    sql/stmt     |            Stmt             |          定义各种SQL语句的Stmt语义           |
|  sql/operator   |              -              |               实现各种运算操作               |
|    sql/expr     |      Expression、Tuple      |         定义表达式类型、表示一行数据         |
|  sql/optimizer  |        OptimizeStage        |                 查询优化阶段                 |
|  sql/executor   |        ExecuteStage         |   SQL执行阶段，实现了各种SQL语句的Executor   |
| sql/plan_cache  |       PlanCacheStage        |          计划缓存阶段，本项目未实现          |
| sql/query_cache |       QueryCacheStage       |          查询缓存阶段，本项目未实现          |
|   storage/db    |             Db              |                 数据库实现类                 |
|  storage/table  |            Table            |                 数据表实现类                 |
| storage/record  |           Record            |               数据表中的记录类               |
|  storage/field  |      Field、FieldMeta       |               数据表中的字段类               |
|  storage/index  |        Index、B+Tree        |               索引类、B+树实现               |
|   storage/trx   |              -              |                    事务类                    |
|  storage/clog   |              -              |      定义事务操作的类型和日志文件的格式      |
| storage/buffer  | Page、Frame、DiskBufferPool |             定义页、页帧、缓冲池             |
| storage/persist |       PersistHandler        |    数据持久化类，定义打开、删除等文件操作    |
| storage/common  |          MetaUtil           |        工具类，指定数据库文件的扩展名        |

## 枚举类说明

|       类       |          路径           |      说明      |
| :------------: | :---------------------: | :------------: |
|       RC       |       common/rc.h       |   函数返回码   |
|     CompOp     | sql/parser/parse_defs.h | 描述比较运算符 |
| SqlCommandFlag | sql/parser/parse_defs.h |  SQL语句类型   |
|    ExprType    |  sql/expr/expression.h  |   表达式类型   |
|    AttrType    |   sql/parser/value.h    |    字段类型    |
|    StmtType    |     sql/stmt/stmt.h     |  Stmt语义类型  |
|    CLogType    |   storage/clog/clog.h   |  事务日志类型  |

## Drop实现解析

假设表名为demo

- 需要删除demo.table文件、demo.data文件和关联的索引文件
- 由于具体执行阶段在CommandExecutor进行分发，因此需要实现DropTableExecutor
- db中实现delete_table接口
- table中实现destroy接口
  - 删除Meta
  - 删除Data
  - 删除索引
  - 清空buffer pool